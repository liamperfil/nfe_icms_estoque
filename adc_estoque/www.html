<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
		* {
			margin: 0;
			padding: 0;
			font-family: 'Calibri', 'Courier New', Courier, monospace;
		}
        #nota {
            margin: 0.5%;
        }
		table, td {
			padding: 2px;
            border: 1px solid black;
			border-collapse: collapse;
		}
	</style>
</head>

<body>
        <form id="form" method="dialog">
            <input id="textinput" name="textinput" value="" type="text" placeholder="digite a chave da nota fiscal" size="47px" autofocus pattern="[0-9]{44}" title="44 digitos, apenas números">
            <button type="submit" onclick="loadDoc()">Confirmar</button>
        </form>

    <table id="demo"></table>
    <script>
        function loadDoc() {
            var textinput = document.getElementById("textinput").value + '.xml';

            const xhttp = new XMLHttpRequest()
            xhttp.onload = function () {
                myFunction(this)
            }
            xhttp.open('GET', textinput)
            xhttp.send()
        }
        
        function myFunction(params) {
            const xmlDoc = params.responseXML
            const prod = xmlDoc.querySelectorAll('prod').length;
			if (prod > 0) {
                document.getElementById('form').style.display = 'none';
			}
            var table = '<tr>';

            for (let i = 0; i < prod; i++) {
                let codigo = xmlDoc.querySelectorAll('cProd')[i].textContent;
                let descricao = xmlDoc.querySelectorAll('xProd')[i].textContent;
                let ncm = xmlDoc.querySelectorAll('NCM')[i].textContent;
                let cfop = xmlDoc.querySelectorAll('CFOP')[i].textContent;
                let un = xmlDoc.querySelectorAll('uCom')[i].textContent;
                let vUnit = Number(xmlDoc.querySelectorAll('vUnCom')[i].textContent);
                let quantidade = xmlDoc.querySelectorAll('qCom')[i].textContent;
                let imposto = xmlDoc.querySelectorAll('imposto')[i];      
                
                let orig = (imposto.querySelectorAll('orig').length > 0) ? imposto.querySelectorAll('orig')[0].textContent : '0';
                let cstICMS = imposto.querySelector('ICMS').querySelectorAll('CST').length;
                let cst = (cstICMS > 0) ? imposto.querySelector('ICMS').querySelectorAll('CST')[0].textContent : '00';

                let pICMS = imposto.querySelectorAll('pICMS').length;
                pICMS = (pICMS > 0) ? Number(imposto.querySelector('pICMS').textContent) : 0;
                let ipi = imposto.querySelectorAll('pIPI').length;
                ipi = (ipi > 0) ? Number(imposto.querySelector('pIPI').textContent) : 0;
                let frete = Number(xmlDoc.querySelector('vFrete').textContent);
                frete = (frete/Number(xmlDoc.querySelector('vNF').textContent)*100);
                let nNF = xmlDoc.querySelector('nNF').textContent;
                let emit = xmlDoc.querySelector('emit');
               let cnpjEmit = emit.querySelector('CNPJ').textContent;
                let razaoEmit = emit.querySelector('xNome').textContent;
                let data = xmlDoc.querySelector('dhEmi').textContent;
                let ano = data.slice(0, 4), mes = data.slice(5, 7), dia = data.slice(8, 10);             
                let vTotal = Number(xmlDoc.querySelector('vNF').textContent);
                let chNFe = xmlDoc.querySelector('chNFe').textContent;
                let UF = emit.querySelector('UF').textContent;
                let tpNF = xmlDoc.querySelector('tpNF').textContent;
                let dest = xmlDoc.querySelector('dest');
                let cnpjDest = dest.querySelector('CNPJ').textContent;
                const prodT = xmlDoc.querySelectorAll('prod')[i];
                let vProd = prodT.querySelector('vProd').textContent;
                
                let vDesc = prodT.querySelectorAll('vDesc').length;
                vDesc = (vDesc > 0) ? prodT.querySelector('vDesc').textContent : 0;
                vDesc = vDesc / vProd * 100;
                
                let COFINS = imposto.querySelector('COFINS');
                let pCOFINS = imposto.querySelectorAll('pCOFINS').length;
                pCOFINS = (pCOFINS > 0) ? 
                    imposto.querySelector('pCOFINS').textContent : 
                    'NT';
                
                let PIS = imposto.querySelector('PIS');
                let pPIS = imposto.querySelectorAll('pPIS').length;
                pPIS = (pPIS > 0) ? 
                    imposto.querySelector('pPIS').textContent : 
                    'NT';
                let pisCST = (PIS.querySelector('CST').textContent == '01') ? 'CST01' : 'ver em outro item';

                let cEAN = prodT.querySelectorAll('cEAN').length;
                cEAN = (cEAN > 0) ? prodT.querySelectorAll('cEAN')[0].textContent : 'não inf';

                table += `<td>${codigo}</td>`; // A
                table += `<td></td>`; // familia B
                table += `<td></td>`; // cód interno C
                table += `<td>${descricao}</td>`; // D
                table += `<td>${ncm}</td>`; // E
                table += `<td>${orig}${cst}</td>`; // F
                table += `<td>${pisCST}/${moeda(pPIS)}/${moeda(pCOFINS)}</td>`; //pis G
                table += `<td>${cfop}</td>`; // H
                table += `<td>${un}</td>`; // I
                table += `<td></td>`; // quantidade em estoque J
                table += `<td>${moeda(vUnit)}</td>`; // valor unitário K
                table += `<td>${moeda(vDesc)}%</td>`; // L
                table += `<td>${moeda(pICMS)}%</td>`; // M
                table += `<td>${moeda(ipi)}%</td>`; // N
                table += `<td>${moeda(frete)}%</td>`; // O
                table += `<td></td>`; // saída P
                table += `<td>${quantidade.replace('.', ',')}</td>`; // Q
                table += `<td>${moeda(vProd)}</td>`; // valor total do item R
                table += `<td>${moeda(pICMS/100 * vProd)}</td>`; // icms total do item S
                table += `<td>${nNF}</td>`; // T
                table += `<td>${cnpjEmit}</td>`; // U
                table += `<td>${razaoEmit}</td>`; // V
                table += `<td>${dia + '/' + mes + '/' + ano}</td>`; // W
                table += `<td>${moeda(vTotal)}</td>`; // X
                table += `<td>${chNFe}</td>`; // Y
                table += `<td>${UF}</td>`; // Z
                table += `<td>${tpNF}</td>`; // AA
                table += `<td>${cnpjDest}</td>`; // AB
                table += `<td>${cEAN}</td>`; // AC
                table += '</tr>';
            }
            document.getElementById('demo').innerHTML = table;

            function moeda(params) {
                let x = Number(params).toFixed(2).replace('.', ',');
                return (x == 'NaN') ? params.replace('.', ',') : x;
            }
        }

    </script>
</body>

</html>